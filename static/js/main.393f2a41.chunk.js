(this["webpackJsonpcloud-image-builder-react"]=this["webpackJsonpcloud-image-builder-react"]||[]).push([[0],{28:function(t,e,n){t.exports=n(37)},34:function(t,e,n){},37:function(t,e,n){"use strict";n.r(e);var a=n(1),r=n.n(a),s=n(15),i=n.n(s),o=(n(33),n(34),n(17)),u=n(5),c=n(6),l=n(8),m=n(7),p=n(27),h=n(11),d=n(20),f=n(16),g=n(10),y=n(19),k=n(25),v=n(13),b=function(t){Object(l.a)(n,t);var e=Object(m.a)(n);function n(){return Object(u.a)(this,n),e.apply(this,arguments)}return Object(c.a)(n,[{key:"render",value:function(){var t=this;return r.a.createElement("div",null,this.props.message.filter((function(t){return!t.match(new RegExp("^(include|exclude) (environment|key|pool|region)s: .*$","i"))&&!t.match(new RegExp("^(pool-deploy|no-ci|no-taskcluster-ci|no-travis-ci)$","i"))})).map((function(t){return r.a.createElement("strong",null,t,r.a.createElement("br",null))})),this.props.message.some((function(t){return t.match(/^(include|exclude) (environment|key|pool|region)s: .*$/i)||t.match(/^(pool-deploy|no-ci|no-taskcluster-ci|no-travis-ci)$/i)}))?this.props.message.filter((function(t){return t.match(/^(pool-deploy|no-ci|no-taskcluster-ci|no-travis-ci)$/i)})).map((function(t){return r.a.createElement(g.a,{style:{marginRight:"0.7em"},variant:"pool-deploy"===t?"primary":"dark"},"pool-deploy"===t?"":r.a.createElement("span",null,r.a.createElement(v.c,null),"\xa0"),t)})):r.a.createElement(g.a,{variant:"warning"},"no commit syntax ci instructions"),["include","exclude"].map((function(e){return t.props.message.some((function(t){return t.match(new RegExp("^"+e+" (environment|key|pool|region)s: .*$","i"))}))?r.a.createElement("span",null,["environments","integrations","keys","pools","regions"].map((function(n){return t.props.message.filter((function(t){return t.startsWith(e+" "+n+": ")})).map((function(t){return t.replace(e+" "+n+": ","").split(", ").map((function(t){return r.a.createElement(g.a,{style:{marginRight:"0.7em"},variant:"include"===e?"info":"dark",title:e+" "+n.slice(0,-1)+": "+t},"include"===e?r.a.createElement(v.d,null):r.a.createElement(v.c,null),"\xa0",t)}))}))})),r.a.createElement("br",null)):""})))}}]),n}(r.a.Component),x={completed:"success",failed:"danger",exception:"warning",running:"primary",pending:"info",unscheduled:"secondary"},E=function(t){Object(l.a)(n,t);var e=Object(m.a)(n);function n(){var t;Object(u.a)(this,n);for(var a=arguments.length,r=new Array(a),s=0;s<a;s++)r[s]=arguments[s];return(t=e.call.apply(e,[this].concat(r))).state={artifacts:[],images:[]},t}return Object(c.a)(n,[{key:"componentDidMount",value:function(){var t=this;fetch(this.props.rootUrl+"/api/queue/v1/task/"+this.props.taskId+"/runs/"+this.props.run.runId+"/artifacts").then((function(t){return t.json()})).then((function(e){if(e.artifacts&&e.artifacts.length){if(t.setState((function(t){return{artifacts:e.artifacts}})),e.artifacts.some((function(t){return t.name.startsWith("public/")&&t.name.endsWith(".json")}))){var n=e.artifacts.find((function(t){return t.name.startsWith("public/")&&t.name.endsWith(".json")}));fetch(t.props.rootUrl+"/api/queue/v1/task/"+t.props.taskId+"/runs/"+t.props.run.runId+"/artifacts/"+n.name).then((function(t){return t.json()})).then((function(e){e.launchConfigs&&e.launchConfigs.length?t.setState((function(t){return{images:e.launchConfigs.map((function(t){return t.storageProfile.imageReference.id}))}})):console.log(e)})).catch(console.log)}}else console.log(e)})).catch(console.log)}},{key:"render",value:function(){return r.a.createElement("li",null,r.a.createElement(y.a,{size:"sm",href:this.props.rootUrl+"/tasks/"+this.props.taskId+"/runs/"+this.props.run.runId,style:{marginLeft:"0.7em"},variant:"outline-"+x[this.props.run.state],title:"task "+this.props.taskId+", run "+this.props.run.runId+": "+this.props.run.state},"task "+this.props.taskId+", run "+this.props.run.runId),"completed"===this.props.run.state&&this.state.images.length?r.a.createElement("div",null,r.a.createElement("span",null,"worker manager image deployments:"),r.a.createElement("ul",null,this.state.images.map((function(t){return r.a.createElement("li",{key:t},t.substring(t.lastIndexOf("/")+1))})))):"")}}]),n}(r.a.Component),j=function(t){Object(l.a)(n,t);var e=Object(m.a)(n);function n(){return Object(u.a)(this,n),e.apply(this,arguments)}return Object(c.a)(n,[{key:"render",value:function(){var t=this;return r.a.createElement("ul",null,this.props.runs.map((function(e){return r.a.createElement(E,{run:e,key:e.runId,taskId:t.props.taskId,rootUrl:t.props.rootUrl})})))}}]),n}(r.a.Component),O=function(t){Object(l.a)(n,t);var e=Object(m.a)(n);function n(){return Object(u.a)(this,n),e.apply(this,arguments)}return Object(c.a)(n,[{key:"render",value:function(){return r.a.createElement("li",null,this.props.task.task.metadata.name,"\xa0",r.a.createElement("a",{href:this.props.rootUrl+"/tasks/"+this.props.task.status.taskId,title:this.props.task.status.taskId},this.props.task.status.taskId.substring(0,7),"..."),r.a.createElement(j,{runs:this.props.task.status.runs,taskId:this.props.task.status.taskId,rootUrl:this.props.rootUrl}))}}]),n}(r.a.Component),w=function(t){Object(l.a)(n,t);var e=Object(m.a)(n);function n(){return Object(u.a)(this,n),e.apply(this,arguments)}return Object(c.a)(n,[{key:"render",value:function(){var t=this;return r.a.createElement("ul",null,this.props.tasks.map((function(e){return r.a.createElement(O,{task:e,key:e.status.taskId,rootUrl:t.props.rootUrl})})))}}]),n}(r.a.Component),I=function(t){Object(l.a)(n,t);var e=Object(m.a)(n);function n(t){var a;return Object(u.a)(this,n),(a=e.call(this,t)).state={summary:{completed:0,failed:0,exception:0,running:0,pending:0,unscheduled:0},showAllTasks:!1,taskGroupId:null,taskCount:0,tasks:[],builds:[],travisApiResponse:{}},a.travisBuildResults=["completed","failed"],a.appendToSummary=a.appendToSummary.bind(Object(h.a)(a)),a}return Object(c.a)(n,[{key:"appendToSummary",value:function(t){var e=this;this.setState((function(n){var a={completed:n.summary.completed+t.completed,failed:n.summary.failed+t.failed,exception:n.summary.exception+t.exception,running:n.summary.running+t.running,pending:n.summary.pending+t.pending,unscheduled:n.summary.unscheduled+t.unscheduled};return e.props.appender(a),{summary:a}}))}},{key:"componentDidMount",value:function(){var t=this;switch(this.props.status.context){case"continuous-integration/travis-ci/push":var e=new URL(this.props.status.target_url).pathname,n=e.substring(e.lastIndexOf("/")+1);this.setState((function(t){return{taskGroupId:n}})),fetch("https://api.travis-ci.org/repos/mozilla-platform-ops/cloud-image-builder/builds/"+n).then((function(t){return t.json()})).then((function(e){e.matrix&&(t.setState((function(t){return{taskCount:e.matrix.length,builds:e.matrix,travisApiResponse:e}})),t.appendToSummary({completed:e.matrix.filter((function(e){return"completed"===t.travisBuildResults[e.result]})).length,failed:e.matrix.filter((function(e){return"failed"===t.travisBuildResults[e.result]})).length,exception:0,running:0,pending:0,unscheduled:0}))})).catch(console.log);break;default:var a=new URL(this.props.status.target_url),r=this.props.status.target_url.substring(this.props.status.target_url.lastIndexOf("/")+1);this.setState((function(t){return{taskGroupId:r}}));var s="https://"+a.hostname+"/api/queue/v1/task-group/"+r+"/list";fetch(s).then((function(t){return t.json()})).then((function(e){e.tasks&&e.tasks.length&&(t.setState((function(t){return{taskCount:e.tasks.length,tasks:e.tasks}})),t.appendToSummary({completed:e.tasks.filter((function(t){return"completed"===t.status.state})).length,failed:e.tasks.filter((function(t){return"failed"===t.status.state})).length,exception:e.tasks.filter((function(t){return"exception"===t.status.state})).length,running:e.tasks.filter((function(t){return"running"===t.status.state})).length,pending:e.tasks.filter((function(t){return"pending"===t.status.state})).length,unscheduled:e.tasks.filter((function(t){return"unscheduled"===t.status.state})).length}))})).catch(console.log)}}},{key:"render",value:function(){var t=this;return r.a.createElement("li",null,new Intl.DateTimeFormat("en-GB",{year:"numeric",month:"short",day:"2-digit",hour:"numeric",minute:"numeric",timeZoneName:"short"}).format(new Date(this.props.status.updated_at)),"\xa0",this.props.status.description.toLowerCase(),"\xa0 (",this.state.taskCount," tasks in group \xa0",r.a.createElement("a",{href:this.props.status.target_url,title:this.state.taskGroupId},this.state.builds.length?this.state.taskGroupId:(this.state.taskGroupId&&this.state.taskGroupId.slice(0,7))+"..."),"\xa0",Object.keys(x).map((function(e){return t.state.tasks.filter((function(t){return t.status.state===e})).length?r.a.createElement(g.a,{style:{margin:"0 1px"},variant:x[e],title:e+": "+t.state.tasks.filter((function(t){return t.status.state===e})).length},t.state.tasks.filter((function(t){return t.status.state===e})).length):""})),[0,1].map((function(e){return t.state.builds.filter((function(t){return t.result===e})).length?r.a.createElement(g.a,{style:{margin:"0 1px"},variant:x[t.travisBuildResults[e]],title:t.travisBuildResults[e]+": "+t.state.builds.filter((function(t){return t.result===e})).length},t.state.builds.filter((function(t){return t.result===e})).length):""})),")",this.state.showAllTasks?r.a.createElement(w,{tasks:this.state.tasks,rootUrl:"https://"+new URL(this.props.status.target_url).hostname}):r.a.createElement("ul",null,this.state.tasks.filter((function(t){return t.task.metadata.name.startsWith("04 :: generate")&&"completed"===t.status.state})).map((function(e){return r.a.createElement(O,{task:e,rootUrl:"https://"+new URL(t.props.status.target_url).hostname})}))))}}]),n}(r.a.Component),S=function(t){Object(l.a)(n,t);var e=Object(m.a)(n);function n(t){var a;return Object(u.a)(this,n),(a=e.call(this,t)).state={summary:{completed:0,failed:0,exception:0,running:0,pending:0,unscheduled:0}},a.appendToSummary=a.appendToSummary.bind(Object(h.a)(a)),a}return Object(c.a)(n,[{key:"appendToSummary",value:function(t){var e=this;this.setState((function(n){var a={completed:n.summary.completed+t.completed,failed:n.summary.failed+t.failed,exception:n.summary.exception+t.exception,running:n.summary.running+t.running,pending:n.summary.pending+t.pending,unscheduled:n.summary.unscheduled+t.unscheduled};return e.props.appender(a),{summary:a}}))}},{key:"componentDidMount",value:function(){this.appendToSummary({completed:3,failed:0,exception:2,running:0,pending:0,unscheduled:0})}},{key:"render",value:function(){var t=this;return r.a.createElement("ul",null,this.props.contexts.map((function(e,n){return r.a.createElement("li",{key:n},e,r.a.createElement("ul",null,t.props.statuses.some((function(t){return t.context===e&&"pending"!==t.state}))?t.props.statuses.filter((function(t){return t.context===e&&"pending"!==t.state})).map((function(e){return r.a.createElement(I,{status:e,key:e.id,appender:t.appendToSummary})})):t.props.statuses.filter((function(t){return t.context===e})).map((function(e){return r.a.createElement(I,{status:e,key:e.id,appender:t.appendToSummary})}))))})))}}]),n}(r.a.Component),C=function(t){Object(l.a)(n,t);var e=Object(m.a)(n);function n(t){var a;return Object(u.a)(this,n),(a=e.call(this,t)).state={summary:{completed:0,failed:0,exception:0,running:0,pending:0,unscheduled:0},contexts:[],statuses:[],expanded:!1},a.appendToSummary=a.appendToSummary.bind(Object(h.a)(a)),a}return Object(c.a)(n,[{key:"appendToSummary",value:function(t){this.setState((function(e){return{summary:{completed:e.summary.completed+t.completed,failed:e.summary.failed+t.failed,exception:e.summary.exception+t.exception,running:e.summary.running+t.running,pending:e.summary.pending+t.pending,unscheduled:e.summary.unscheduled+t.unscheduled}}}))}},{key:"componentDidMount",value:function(){var t=this;this.setState((function(e){return{expanded:t.props.expand}})),fetch("localhost"===window.location.hostname?"http://localhost:8010/proxy/repos/mozilla-platform-ops/cloud-image-builder/commits/"+this.props.commit.sha+"/statuses":"https://grenade-cors-proxy.herokuapp.com/https://api.github.com/repos/mozilla-platform-ops/cloud-image-builder/commits/"+this.props.commit.sha+"/statuses").then((function(t){return t.json()})).then((function(e){e.length&&t.setState((function(t){return{contexts:Object(p.a)(new Set(e.map((function(t){return t.context})))).sort((function(t,e){return t.toLowerCase().localeCompare(e.toLowerCase())})),statuses:e}}))})).catch(console.log)}},{key:"render",value:function(){var t=this;return r.a.createElement(d.a,{style:{width:"100%",marginTop:"10px"}},r.a.createElement(d.a.Header,null,r.a.createElement(f.a.Toggle,{as:y.a,variant:"link",eventKey:this.props.commit.sha,onClick:function(){t.setState((function(t){return{expanded:!t.expanded}}))}},this.state.expanded?r.a.createElement(v.a,null):r.a.createElement(v.b,null)),new Intl.DateTimeFormat("en-GB",{year:"numeric",month:"short",day:"2-digit",hour:"numeric",minute:"numeric",timeZoneName:"short"}).format(new Date(this.props.commit.committer.date)),"\xa0",r.a.createElement("a",{href:this.props.commit.url},this.props.commit.sha.substring(0,7)),Object.keys(this.state.summary).filter((function(e){return t.state.summary[e]>0})).map((function(e){return r.a.createElement(g.a,{style:{marginLeft:"0.3em"},variant:x[e]},t.state.summary[e])})),r.a.createElement(k.a,{src:this.props.commit.author.avatar,alt:this.props.commit.author.name,title:this.props.commit.author.name,rounded:!0,style:{width:"30px",height:"30px",marginLeft:"10px"},className:"float-right"}),r.a.createElement("span",{className:"float-right"},this.props.commit.author.username)),r.a.createElement(f.a.Collapse,{eventKey:this.props.commit.sha},r.a.createElement(d.a.Body,null,r.a.createElement(b,{message:this.props.commit.message}),r.a.createElement(S,{contexts:this.state.contexts,statuses:this.state.statuses,appender:this.appendToSummary}))))}}]),n}(r.a.Component),T=function(t){Object(l.a)(n,t);var e=Object(m.a)(n);function n(){return Object(u.a)(this,n),e.apply(this,arguments)}return Object(c.a)(n,[{key:"render",value:function(){return r.a.createElement(f.a,{defaultActiveKey:null},this.props.commits.map((function(t){return r.a.createElement(C,{commit:t,key:t.sha,expand:!1})})))}}]),n}(r.a.Component),R=n(26),U=function(t){Object(l.a)(n,t);var e=Object(m.a)(n);function n(){var t;Object(u.a)(this,n);for(var a=arguments.length,r=new Array(a),s=0;s<a;s++)r[s]=arguments[s];return(t=e.call.apply(e,[this].concat(r))).state={commits:[]},t}return Object(c.a)(n,[{key:"componentDidMount",value:function(){var t=this;fetch("localhost"===window.location.hostname?"http://localhost:8010/proxy/repos/mozilla-platform-ops/cloud-image-builder/commits":"https://grenade-cors-proxy.herokuapp.com/https://api.github.com/repos/mozilla-platform-ops/cloud-image-builder/commits").then((function(t){return t.json()})).then((function(e){e.length?t.setState((function(t){return{commits:e.map((function(t){return{sha:t.sha,url:t.html_url,author:Object(o.a)(Object(o.a)({},t.commit.author),{id:t.author.id,username:t.author.login,avatar:t.author.avatar_url}),committer:Object(o.a)(Object(o.a)({},t.commit.committer),{id:t.committer.id,username:t.committer.login,avatar:t.committer.avatar_url}),message:t.commit.message.split("\n").filter((function(t){return""!==t})),verification:t.commit.verification}})),latest:e[0].sha}})):console.log(e)})).catch(console.log)}},{key:"render",value:function(){return r.a.createElement(R.a,null,r.a.createElement(T,{commits:this.state.commits,latest:this.state.latest}))}}]),n}(r.a.Component);Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));i.a.render(r.a.createElement(r.a.StrictMode,null,r.a.createElement(U,null)),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(t){t.unregister()})).catch((function(t){console.error(t.message)}))}},[[28,1,2]]]);
//# sourceMappingURL=main.393f2a41.chunk.js.map