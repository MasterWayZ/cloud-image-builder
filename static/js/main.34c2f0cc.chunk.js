(this["webpackJsonpcloud-image-builder-react"]=this["webpackJsonpcloud-image-builder-react"]||[]).push([[0],{303:function(t,e,a){"use strict";a.r(e);var n=a(1),s=a.n(n),r=a(11),i=a.n(r),o=(a(72),a(73),a(74),a(75),a(2)),l=a(7),u=a(8),c=a(10),m=a(9),p=a(46),d=a(47),h=a(25),g=a(13),f=a(36),k=a(35),b=a(14),y=a(22),v=a(62),j=a(27),O=a(31),E=function(t){Object(c.a)(a,t);var e=Object(m.a)(a);function a(){return Object(l.a)(this,a),e.apply(this,arguments)}return Object(u.a)(a,[{key:"render",value:function(){var t=this;return s.a.createElement("div",null,this.props.message.filter((function(t){return!t.match(new RegExp("^(include|exclude) (environment|key|pool|region)s: .*$","i"))&&!t.match(new RegExp("^(pool-deploy|overwrite-disk-image|overwrite-machine-image|disable-cleanup|purge-taskcluster-resources|no-ci|no-taskcluster-ci|no-travis-ci)$","i"))})).map((function(t,e){return 0===e?t.match(/bug ([0-9]{5,8})/i)?s.a.createElement("span",{key:e},s.a.createElement("a",{href:"https://bugzilla.mozilla.org/show_bug.cgi?id="+t.match(/bug ([0-9]{5,8})/i)[1],target:"_blank",rel:"noopener noreferrer"},t.match(/bug ([0-9]{5,8})/i)[0])," ",t.replace(t.match(/bug ([0-9]{5,8})/i)[0],""),s.a.createElement("br",null)):s.a.createElement("strong",{key:e},t,s.a.createElement("br",null)):t.match(/bug ([0-9]{5,8})/i)?s.a.createElement("span",{key:e},s.a.createElement("a",{href:"https://bugzilla.mozilla.org/show_bug.cgi?id="+t.match(/bug ([0-9]{5,8})/i)[1],target:"_blank",rel:"noopener noreferrer"},t.match(/bug ([0-9]{5,8})/i)[0])," ",t.replace(t.match(/bug ([0-9]{5,8})/i)[0],""),s.a.createElement("br",null)):s.a.createElement("span",{key:e},t,s.a.createElement("br",null))})),this.props.message.some((function(t){return t.match(/^(include|exclude) (environment|key|pool|region)s: .*$/i)||t.match(/^(pool-deploy|overwrite-disk-image|overwrite-machine-image|disable-cleanup|purge-taskcluster-resources|no-ci|no-taskcluster-ci|no-travis-ci)$/i)}))?this.props.message.filter((function(t){return t.match(/^(pool-deploy|overwrite-disk-image|overwrite-machine-image|disable-cleanup|purge-taskcluster-resources|no-ci|no-taskcluster-ci|no-travis-ci)$/i)})).map((function(t){return s.a.createElement(b.a,{key:t,style:{marginRight:"0.7em"},variant:["pool-deploy","overwrite-disk-image","overwrite-machine-image","disable-cleanup","purge-taskcluster-resources"].includes(t)?"primary":"dark"},t)})):s.a.createElement(b.a,{variant:"warning"},"no commit syntax ci instructions"),["include","exclude"].map((function(e){return t.props.message.some((function(t){return t.match(new RegExp("^"+e+" (environment|key|pool|region)s: .*$","i"))}))?s.a.createElement("span",{key:e},["environments","integrations","keys","pools","regions"].map((function(a){return t.props.message.filter((function(t){return t.startsWith(e+" "+a+": ")})).map((function(t,n){return t.replace(e+" "+a+": ","").split(", ").map((function(t){return s.a.createElement(b.a,{key:n,style:{marginRight:"0.7em"},variant:"include"===e?"info":"dark",title:e+" "+a.slice(0,-1)+": "+t},"include"===e?s.a.createElement(O.d,null):s.a.createElement(O.c,null),"\xa0",t)}))}))})),s.a.createElement("br",null)):""})))}}]),a}(s.a.Component),w=a(26),x=a(24),S=a(15),I=a(18),T=function(t){Object(c.a)(a,t);var e=Object(m.a)(a);function a(){var t;Object(l.a)(this,a);for(var n=arguments.length,s=new Array(n),r=0;r<n;r++)s[r]=arguments[r];return(t=e.call.apply(e,[this].concat(s))).re=/^((north|south|east|west|(north-|south-|west-)?central)-us(-2)?)-(.*)-(win.*)-([a-f0-9]{7})-([a-f0-9]{7})$/i,t.state={domain:null,pool:null,region:null,sha:{bootstrap:null,disk:null}},t}return Object(u.a)(a,[{key:"componentDidMount",value:function(){var t=this.props.image.substring(this.props.image.lastIndexOf("/")+1).match(this.re);this.setState((function(e){return{domain:t[5],pool:t[6],region:t[1],sha:{bootstrap:t[8],disk:t[7]}}}))}},{key:"render",value:function(){return s.a.createElement("li",null,s.a.createElement("a",{href:"https://portal.azure.com/#@taskclusteraccountsmozilla.onmicrosoft.com/resource"+this.props.image,target:"_blank",rel:"noopener noreferrer"},this.state.region,"-",this.state.domain,"-",this.state.pool,"-",this.state.sha.disk,"-",this.state.sha.bootstrap))}}]),a}(s.a.Component),C=function(t){Object(c.a)(a,t);var e=Object(m.a)(a);function a(){return Object(l.a)(this,a),e.apply(this,arguments)}return Object(u.a)(a,[{key:"render",value:function(){return s.a.createElement("div",null,s.a.createElement("span",null,"worker manager image deployments:"),s.a.createElement("ul",null,this.props.images.map((function(t){return s.a.createElement(T,{image:t,key:t})}))))}}]),a}(s.a.Component),z=function(t){Object(c.a)(a,t);var e=Object(m.a)(a);function a(){var t;Object(l.a)(this,a);for(var n=arguments.length,s=new Array(n),r=0;r<n;r++)s[r]=arguments[r];return(t=e.call.apply(e,[this].concat(s))).state={logs:[]},t}return Object(u.a)(a,[{key:"componentDidMount",value:function(){var t=this;this.setState((function(e){return{logs:t.props.logs.map((function(e){return{name:e.name,contentType:e.contentType,url:"https://artifacts.tcstage.mozaws.net/"+t.props.taskId+"/"+t.props.runId+"/"+e.name}}))}}))}},{key:"render",value:function(){return s.a.createElement("ul",null,this.state.logs.map((function(t){return s.a.createElement("li",{key:t.name},s.a.createElement("a",{href:t.url,target:"_blank",rel:"noopener noreferrer"},t.name))})))}}]),a}(s.a.Component),W=a(58),U=a.n(W),_=function(t){Object(c.a)(a,t);var e=Object(m.a)(a);function a(){var t;Object(l.a)(this,a);for(var n=arguments.length,s=new Array(n),r=0;r<n;r++)s[r]=arguments[r];return(t=e.call.apply(e,[this].concat(s))).state={screenshots:[],thumbnailPosition:window.innerWidth<960?"bottom":"left",galleryHeight:window.innerWidth<960?554:480,galleryWidth:window.innerWidth<960?640:698},t.updateDimensions=function(){window.innerWidth<960?t.setState((function(t){return{thumbnailPosition:"bottom",galleryHeight:554,galleryWidth:640}})):t.setState((function(t){return{thumbnailPosition:"left",galleryHeight:480,galleryWidth:698}}))},t}return Object(u.a)(a,[{key:"componentDidMount",value:function(){var t=this;window.addEventListener("resize",this.updateDimensions),this.setState((function(e){return{screenshots:t.props.screenshots.map((function(e){var a=e.name.split("/").pop().replace(/\.[^/.]+$/,"").split("").reverse().join("").replace("-"," ").split("").reverse().join(""),n=a.split(" ")[1],s=a.split(" ")[0]+" - "+new Intl.DateTimeFormat("en-GB",{year:"numeric",month:"short",day:"2-digit",hour:"numeric",minute:"numeric",timeZoneName:"short"}).format(new Date(n.slice(0,4)+"-"+n.slice(4,6)+"-"+n.slice(6,8)+"T"+n.slice(9,11)+":"+n.slice(11,13)+":00Z"));return{original:"https://artifacts.tcstage.mozaws.net/"+t.props.taskId+"/"+t.props.runId+"/"+e.name,originalAlt:a,originalTitle:s,thumbnail:"https://artifacts.tcstage.mozaws.net/"+t.props.taskId+"/"+t.props.runId+"/"+e.name.replace("/full/","/thumbnail/").replace(".png","-64x48.png"),thumbnailAlt:a,thumbnailTitle:s}}))}}))}},{key:"componentWillUnmount",value:function(){window.removeEventListener("resize",this.updateDimensions)}},{key:"render",value:function(){return s.a.createElement("div",{style:{width:this.state.galleryWidth+"px",minHeight:this.state.galleryHeight+"px"}},s.a.createElement(U.a,{items:this.state.screenshots,startIndex:this.state.screenshots.length-1,showIndex:!0,thumbnailPosition:this.state.thumbnailPosition}))}}]),a}(s.a.Component),N={completed:"success",failed:"danger",exception:"warning",running:"primary",pending:"info",unscheduled:"secondary"},L=a(308),R=a(307),A=function(t){Object(c.a)(a,t);var e=Object(m.a)(a);function a(t){var n;return Object(l.a)(this,a),(n=e.call(this,t)).state={summary:{task:{completed:{},failed:{},exception:{},running:{},pending:{},unscheduled:{}},image:{}},artifacts:[],logs:[],screenshots:[],images:[],unattend:null},n.appendToSummary=n.appendToSummary.bind(Object(g.a)(n)),n}return Object(u.a)(a,[{key:"appendToSummary",value:function(t){var e=this;this.setState((function(a){var n={task:{completed:Object(o.a)(Object(o.a)({},a.summary.task.completed),t.task.completed),failed:Object(o.a)(Object(o.a)({},a.summary.task.failed),t.task.failed),exception:Object(o.a)(Object(o.a)({},a.summary.task.exception),t.task.exception),running:Object(o.a)(Object(o.a)({},a.summary.task.running),t.task.running),pending:Object(o.a)(Object(o.a)({},a.summary.task.pending),t.task.pending),unscheduled:Object(o.a)(Object(o.a)({},a.summary.task.unscheduled),t.task.unscheduled)},image:Object(o.a)(Object(o.a)({},a.summary.image),t.image)};return e.props.appender(n),{summary:n}}))}},{key:"componentDidMount",value:function(){var t=this;fetch(this.props.rootUrl+"/api/queue/v1/task/"+this.props.taskId+"/runs/"+this.props.run.runId+"/artifacts").then((function(t){return t.json()})).then((function(e){if(e.artifacts&&e.artifacts.length&&(t.setState((function(t){return{artifacts:e.artifacts,logs:e.artifacts.filter((function(t){return t.contentType.startsWith("text/plain")&&t.name.startsWith("public/instance-logs/")&&t.name.endsWith(".log")})),screenshots:e.artifacts.filter((function(t){return"image/png"===t.contentType&&t.name.startsWith("public/screenshot/full/")&&t.name.endsWith(".png")}))}})),e.artifacts.some((function(t){return"public/unattend.xml"===t.name}))&&fetch("https://artifacts.tcstage.mozaws.net/"+t.props.taskId+"/"+t.props.run.runId+"/public/unattend.xml").then((function(t){return t.text()})).then((function(e){t.setState((function(t){return{unattend:e}}))})),e.artifacts.some((function(t){return t.name.startsWith("public/")&&t.name.endsWith(".json")})))){var a=e.artifacts.find((function(t){return t.name.startsWith("public/")&&t.name.endsWith(".json")}));fetch(t.props.rootUrl+"/api/queue/v1/task/"+t.props.taskId+"/runs/"+t.props.run.runId+"/artifacts/"+a.name).then((function(t){return t.json()})).then((function(e){if(e.launchConfigs&&e.launchConfigs.length){var a=e.launchConfigs.map((function(t){return t.storageProfile.imageReference.id}));t.setState((function(t){return{images:a}}));var n=/^((north|south|east|west|(north-|south-|east-|west-)?central)-us(-2)?)-(.*)-(win.*)-([a-f0-9]{7})-([a-f0-9]{7})$/i;t.appendToSummary({task:{completed:0,failed:0,exception:0,running:0,pending:0,unscheduled:0},image:a.reduce((function(t,e,a){var s=e.substring(e.lastIndexOf("/")+1).match(n),r=s[5]+"/"+s[6];return t[r]=(t[r]||0)+1,t}),{})})}})).catch(console.log)}})).catch(console.log)}},{key:"render",value:function(){return s.a.createElement("li",null,s.a.createElement(y.a,{size:"sm",href:this.props.rootUrl+"/tasks/"+this.props.taskId+"/runs/"+this.props.run.runId,style:{marginLeft:"0.7em"},variant:"outline-"+N[this.props.run.state],title:"task "+this.props.taskId+", run "+this.props.run.runId+": "+this.props.run.state},"task "+this.props.taskId+", run "+this.props.run.runId),this.props.taskName.startsWith("01")&&this.state.unattend?"completed"===this.props.run.state||"failed"===this.props.run.state?s.a.createElement(L.a,{language:"xml",style:R.a,showLineNumbers:!0,customStyle:{maxHeight:"800px",fontSize:"x-small"}},this.state.unattend):s.a.createElement("a",{style:{marginLeft:"1em"},href:"https://stage.taskcluster.nonprod.cloudops.mozgcp.net/tasks/"+this.props.taskId+"/runs/"+this.props.run.runId+"/#artifacts",target:"_blank",rel:"noopener noreferrer"},"artifacts"):null,this.props.taskName.startsWith("02")?this.state.screenshots.length?"completed"===this.props.run.state||"failed"===this.props.run.state?s.a.createElement(_,{screenshots:this.state.screenshots,taskId:this.props.taskId,runId:this.props.run.runId}):s.a.createElement("a",{style:{marginLeft:"1em"},href:"https://stage.taskcluster.nonprod.cloudops.mozgcp.net/tasks/"+this.props.taskId+"/runs/"+this.props.run.runId+"/#artifacts",target:"_blank",rel:"noopener noreferrer"},"screenshots (",this.state.screenshots.length,")"):this.state.loading?s.a.createElement(j.a,{style:{marginLeft:"1em"},animation:"grow",variant:"secondary",size:"sm"}):null:null,this.props.taskName.startsWith("02")&&this.state.logs.length?s.a.createElement(z,{logs:this.state.logs,taskId:this.props.taskId,runId:this.props.run.runId}):null,this.props.taskName.startsWith("03")&&this.state.images.length?s.a.createElement(C,{images:this.state.images}):null)}}]),a}(s.a.Component),D=function(t){Object(c.a)(a,t);var e=Object(m.a)(a);function a(t){var n;return Object(l.a)(this,a),(n=e.call(this,t)).state={summary:{task:{completed:{},failed:{},exception:{},running:{},pending:{},unscheduled:{}},image:{}}},n.appendToSummary=n.appendToSummary.bind(Object(g.a)(n)),n}return Object(u.a)(a,[{key:"appendToSummary",value:function(t){var e=this;this.setState((function(a){var n={task:{completed:Object(o.a)(Object(o.a)({},a.summary.task.completed),t.task.completed),failed:Object(o.a)(Object(o.a)({},a.summary.task.failed),t.task.failed),exception:Object(o.a)(Object(o.a)({},a.summary.task.exception),t.task.exception),running:Object(o.a)(Object(o.a)({},a.summary.task.running),t.task.running),pending:Object(o.a)(Object(o.a)({},a.summary.task.pending),t.task.pending),unscheduled:Object(o.a)(Object(o.a)({},a.summary.task.unscheduled),t.task.unscheduled)},image:Object(o.a)(Object(o.a)({},a.summary.image),t.image)};return e.props.appender(n),{summary:n}}))}},{key:"render",value:function(){var t=this;return s.a.createElement("ul",null,this.props.runs.map((function(e){return s.a.createElement(A,{run:e,key:e.runId,taskId:t.props.taskId,taskName:t.props.taskName,rootUrl:t.props.rootUrl,appender:t.appendToSummary})})))}}]),a}(s.a.Component),B=function(t){Object(c.a)(a,t);var e=Object(m.a)(a);function a(t){var n;return Object(l.a)(this,a),(n=e.call(this,t)).state={summary:{task:{completed:{},failed:{},exception:{},running:{},pending:{},unscheduled:{}},image:{}}},n.appendToSummary=n.appendToSummary.bind(Object(g.a)(n)),n}return Object(u.a)(a,[{key:"appendToSummary",value:function(t){var e=this;this.setState((function(a){var n={task:{completed:Object(o.a)(Object(o.a)({},a.summary.task.completed),t.task.completed),failed:Object(o.a)(Object(o.a)({},a.summary.task.failed),t.task.failed),exception:Object(o.a)(Object(o.a)({},a.summary.task.exception),t.task.exception),running:Object(o.a)(Object(o.a)({},a.summary.task.running),t.task.running),pending:Object(o.a)(Object(o.a)({},a.summary.task.pending),t.task.pending),unscheduled:Object(o.a)(Object(o.a)({},a.summary.task.unscheduled),t.task.unscheduled)},image:Object(o.a)(Object(o.a)({},a.summary.image),t.image)};return e.props.appender(n),{summary:n}}))}},{key:"render",value:function(){var t=this;return["01","02"].includes(this.props.task.task.metadata.name.slice(0,2))?s.a.createElement("li",{style:{listStyleType:"none",margin:0,padding:0}},s.a.createElement("h6",null,this.props.task.task.metadata.name),s.a.createElement("a",{href:this.props.rootUrl+"/tasks/"+this.props.task.status.taskId,title:this.props.task.status.taskId},this.props.task.status.taskId),Array.from(new Set(this.props.task.status.runs.map((function(t){return t.state})))).map((function(e){return s.a.createElement(b.a,{key:e,style:{margin:"0 1px"},variant:N[e],title:e+": "+t.props.task.status.runs.filter((function(t){return t.state===e})).length},t.props.task.status.runs.filter((function(t){return t.state===e})).length)})),s.a.createElement("hr",null),s.a.createElement(D,{runs:this.props.task.status.runs,taskId:this.props.task.status.taskId,taskName:this.props.task.task.metadata.name,rootUrl:this.props.rootUrl,appender:this.appendToSummary})):s.a.createElement("li",null,this.props.task.task.metadata.name,"\xa0",s.a.createElement("a",{href:this.props.rootUrl+"/tasks/"+this.props.task.status.taskId,title:this.props.task.status.taskId},this.props.task.status.taskId),Array.from(new Set(this.props.task.status.runs.map((function(t){return t.state})))).map((function(e){return s.a.createElement(b.a,{key:e,style:{margin:"0 1px"},variant:N[e],title:e+": "+t.props.task.status.runs.filter((function(t){return t.state===e})).length},t.props.task.status.runs.filter((function(t){return t.state===e})).length)})),s.a.createElement("hr",null),s.a.createElement(D,{runs:this.props.task.status.runs,taskId:this.props.task.status.taskId,taskName:this.props.task.task.metadata.name,rootUrl:this.props.rootUrl,appender:this.appendToSummary}))}}]),a}(s.a.Component),K=function(t){Object(c.a)(a,t);var e=Object(m.a)(a);function a(t){var n;return Object(l.a)(this,a),(n=e.call(this,t)).state={summary:{task:{completed:{},failed:{},exception:{},running:{},pending:{},unscheduled:{}},image:{}}},n.appendToSummary=n.appendToSummary.bind(Object(g.a)(n)),n}return Object(u.a)(a,[{key:"appendToSummary",value:function(t){var e=this;this.setState((function(a){var n={task:{completed:Object(o.a)(Object(o.a)({},a.summary.task.completed),t.task.completed),failed:Object(o.a)(Object(o.a)({},a.summary.task.failed),t.task.failed),exception:Object(o.a)(Object(o.a)({},a.summary.task.exception),t.task.exception),running:Object(o.a)(Object(o.a)({},a.summary.task.running),t.task.running),pending:Object(o.a)(Object(o.a)({},a.summary.task.pending),t.task.pending),unscheduled:Object(o.a)(Object(o.a)({},a.summary.task.unscheduled),t.task.unscheduled)},image:Object(o.a)(Object(o.a)({},a.summary.image),t.image)};return e.props.appender(n),{summary:n}}))}},{key:"render",value:function(){var t=this;switch(this.props.tasks[0].task.metadata.name.slice(0,2)){case"01":var e=Object(h.a)(new Set(this.props.tasks.map((function(t){return t.task.metadata.name.split(" ")[3]})))).sort().reverse();return e.length>1?s.a.createElement(x.a,{variant:"tabs",transition:!1,defaultActiveKey:e[0]},e.map((function(e){return s.a.createElement(w.a,{key:e,eventKey:e,title:s.a.createElement("span",null,e)},s.a.createElement("hr",{style:{borderStyle:"dotted"}}),s.a.createElement("ul",{style:{listStyleType:"none",margin:0,padding:0}},t.props.tasks.filter((function(t){return t.task.metadata.name.includes(e)})).sort((function(t,e){return t.task.metadata.name<e.task.metadata.name?-1:t.task.metadata.name>e.task.metadata.name?1:0})).map((function(e){return s.a.createElement(B,{task:e,key:e.status.taskId,rootUrl:t.props.rootUrl,appender:t.appendToSummary})}))))}))):s.a.createElement("ul",null,this.props.tasks.sort((function(t,e){return t.task.metadata.name<e.task.metadata.name?-1:t.task.metadata.name>e.task.metadata.name?1:0})).map((function(e){return s.a.createElement(B,{task:e,key:e.status.taskId,rootUrl:t.props.rootUrl,appender:t.appendToSummary})})));case"02":var a=Object(h.a)(new Set(this.props.tasks.map((function(t){return t.task.metadata.name.split(" ")[3]+"/"+t.task.metadata.name.split(" ").pop()})))).sort();return a.length>1?s.a.createElement(x.a,{variant:"tabs",transition:!1,defaultActiveKey:a[0]},a.map((function(e){return s.a.createElement(w.a,{key:e,eventKey:e,title:s.a.createElement("span",null,e)},s.a.createElement("hr",{style:{borderStyle:"dotted"}}),s.a.createElement("ul",{style:{listStyleType:"none",margin:0,padding:0}},t.props.tasks.filter((function(t){return t.task.metadata.name.includes(e.split("/")[0])&&t.task.metadata.name.endsWith(e.split("/").pop())})).sort((function(t,e){return t.task.metadata.name<e.task.metadata.name?-1:t.task.metadata.name>e.task.metadata.name?1:0})).map((function(e){return s.a.createElement(B,{task:e,key:e.status.taskId,rootUrl:t.props.rootUrl,appender:t.appendToSummary})}))))}))):s.a.createElement("ul",null,this.props.tasks.sort((function(t,e){return t.task.metadata.name<e.task.metadata.name?-1:t.task.metadata.name>e.task.metadata.name?1:0})).map((function(e){return s.a.createElement(B,{task:e,key:e.status.taskId,rootUrl:t.props.rootUrl,appender:t.appendToSummary})})));default:return s.a.createElement("ul",null,this.props.tasks.sort((function(t,e){return t.task.metadata.name<e.task.metadata.name?-1:t.task.metadata.name>e.task.metadata.name?1:0})).map((function(e){return s.a.createElement(B,{task:e,key:e.status.taskId,rootUrl:t.props.rootUrl,appender:t.appendToSummary})})))}}}]),a}(s.a.Component),M={"00":"setup and validation","01":"disk image builds","02":"machine image builds","03":"worker pool deployments","04":"worker pool tests"},$=function(t){Object(c.a)(a,t);var e=Object(m.a)(a);function a(t){var n;return Object(l.a)(this,a),(n=e.call(this,t)).state={summary:{task:{completed:{},failed:{},exception:{},running:{},pending:{},unscheduled:{}},image:{}},taskGroupId:null,taskCount:0,tasks:[],builds:[],travisApiResponse:{}},n.travisBuildResults=["completed","failed"],n.appendToSummary=n.appendToSummary.bind(Object(g.a)(n)),n}return Object(u.a)(a,[{key:"appendToSummary",value:function(t){var e=this;this.setState((function(a){var n={task:{completed:Object(o.a)(Object(o.a)({},a.summary.task.completed),t.task.completed),failed:Object(o.a)(Object(o.a)({},a.summary.task.failed),t.task.failed),exception:Object(o.a)(Object(o.a)({},a.summary.task.exception),t.task.exception),running:Object(o.a)(Object(o.a)({},a.summary.task.running),t.task.running),pending:Object(o.a)(Object(o.a)({},a.summary.task.pending),t.task.pending),unscheduled:Object(o.a)(Object(o.a)({},a.summary.task.unscheduled),t.task.unscheduled)},image:Object(o.a)(Object(o.a)({},a.summary.image),t.image)};return e.props.appender(n),{summary:n}}))}},{key:"componentDidMount",value:function(){var t=this;switch(this.props.status.context){case"continuous-integration/travis-ci/push":var e=new URL(this.props.status.target_url).pathname,a=e.substring(e.lastIndexOf("/")+1);this.setState((function(t){return{taskGroupId:a}}));var n="https://api.travis-ci.org/repos/mozilla-platform-ops/cloud-image-builder/builds/"+a;fetch(n).then((function(t){return t.json()})).then((function(e){e.matrix&&(t.setState((function(t){return{taskCount:e.matrix.length,builds:e.matrix,travisApiResponse:e}})),t.appendToSummary({task:{completed:Object(o.a)({},e.matrix.filter((function(t){return 0===t.result})).map((function(t){return[t.id,t.finished_at]})).reduce((function(t,e){var a=Object(I.a)(e,2),n=a[0],s=a[1];return Object(o.a)(Object(o.a)({},t),{},Object(S.a)({},n,s))}),{})),failed:Object(o.a)({},e.matrix.filter((function(t){return null!==t.result&&0!==t.result})).map((function(t){return[t.id,t.finished_at]})).reduce((function(t,e){var a=Object(I.a)(e,2),n=a[0],s=a[1];return Object(o.a)(Object(o.a)({},t),{},Object(S.a)({},n,s))}),{})),exception:{},running:{},pending:Object(o.a)({},e.matrix.filter((function(t){return null===t.result})).map((function(t){return[t.id,t.finished_at]})).reduce((function(t,e){var a=Object(I.a)(e,2),n=a[0],s=a[1];return Object(o.a)(Object(o.a)({},t),{},Object(S.a)({},n,s))}),{})),unscheduled:{}},image:[]}))})).catch((function(t){return console.log("error fetching: "+n,t)}));break;default:var s=new URL(this.props.status.target_url),r=this.props.status.target_url.substring(this.props.status.target_url.lastIndexOf("/")+1);this.setState((function(t){return{taskGroupId:r}}));var i="https://"+s.hostname+"/api/queue/v1/task-group/"+r+"/list";fetch(i).then((function(t){return t.json()})).then((function(e){e.tasks&&e.tasks.length&&(t.setState((function(t){return{taskCount:e.tasks.length,tasks:e.tasks}})),t.appendToSummary({task:{completed:Object(o.a)({},e.tasks.filter((function(t){return"completed"===t.status.state})).map((function(t){return[t.status.taskId,t.status.runs[t.status.runs.length-1].resolved]})).reduce((function(t,e){var a=Object(I.a)(e,2),n=a[0],s=a[1];return Object(o.a)(Object(o.a)({},t),{},Object(S.a)({},n,s))}),{})),failed:Object(o.a)({},e.tasks.filter((function(t){return"failed"===t.status.state})).map((function(t){return[t.status.taskId,t.status.runs[t.status.runs.length-1].resolved]})).reduce((function(t,e){var a=Object(I.a)(e,2),n=a[0],s=a[1];return Object(o.a)(Object(o.a)({},t),{},Object(S.a)({},n,s))}),{})),exception:Object(o.a)({},e.tasks.filter((function(t){return"exception"===t.status.state})).map((function(t){return[t.status.taskId,t.status.runs[t.status.runs.length-1].resolved]})).reduce((function(t,e){var a=Object(I.a)(e,2),n=a[0],s=a[1];return Object(o.a)(Object(o.a)({},t),{},Object(S.a)({},n,s))}),{})),running:Object(o.a)({},e.tasks.filter((function(t){return"running"===t.status.state})).map((function(t){return[t.status.taskId,null]})).reduce((function(t,e){var a=Object(I.a)(e,2),n=a[0],s=a[1];return Object(o.a)(Object(o.a)({},t),{},Object(S.a)({},n,s))}),{})),pending:Object(o.a)({},e.tasks.filter((function(t){return"pending"===t.status.state})).map((function(t){return[t.status.taskId,null]})).reduce((function(t,e){var a=Object(I.a)(e,2),n=a[0],s=a[1];return Object(o.a)(Object(o.a)({},t),{},Object(S.a)({},n,s))}),{})),unscheduled:Object(o.a)({},e.tasks.filter((function(t){return"unscheduled"===t.status.state})).map((function(t){return[t.status.taskId,null]})).reduce((function(t,e){var a=Object(I.a)(e,2),n=a[0],s=a[1];return Object(o.a)(Object(o.a)({},t),{},Object(S.a)({},n,s))}),{}))},image:[]}))})).catch((function(t){return console.log("error fetching: "+i,t)}))}}},{key:"render",value:function(){var t=this;return s.a.createElement(s.a.Fragment,null,s.a.createElement("h5",{style:{marginTop:"1em"},className:"muted"},new Intl.DateTimeFormat("en-GB",{year:"numeric",month:"short",day:"2-digit",hour:"numeric",minute:"numeric",timeZoneName:"short"}).format(new Date(this.props.status.updated_at)),"\xa0",this.props.status.description.toLowerCase()),s.a.createElement("span",{style:{marginTop:"0.5em"}},"(",this.state.taskCount," tasks in group \xa0",s.a.createElement("a",{href:this.props.status.target_url,title:this.state.taskGroupId},(this.state.builds.length||this.state.taskGroupId)&&this.state.taskGroupId),"\xa0",Object.keys(N).map((function(e){return t.state.tasks.filter((function(t){return t.status.state===e})).length?s.a.createElement(b.a,{key:e,style:{margin:"0 1px"},variant:N[e],title:e+": "+t.state.tasks.filter((function(t){return t.status.state===e})).length},t.state.tasks.filter((function(t){return t.status.state===e})).length):""})),[0,1,null].map((function(e,a){return t.state.builds.filter((function(t){return t.result===e})).length?s.a.createElement(b.a,{key:a,style:{margin:"0 1px"},variant:null===e?"info":N[t.travisBuildResults[e]],title:t.travisBuildResults[e]+": "+t.state.builds.filter((function(t){return t.result===e})).length},t.state.builds.filter((function(t){return t.result===e})).length):""})),")"),s.a.createElement("hr",null),s.a.createElement(x.a,{variant:"tabs",transition:null,defaultActiveKey:"02"},Object(h.a)(new Set(this.state.tasks.map((function(t){return t.task.metadata.name.slice(0,2)})))).sort().map((function(e){return s.a.createElement(w.a,{key:e,eventKey:e,title:s.a.createElement("span",null,e," :: ",M[e])},s.a.createElement("hr",{style:{borderStyle:"dotted"}}),s.a.createElement(K,{tasks:t.state.tasks.filter((function(t){return t.task.metadata.name.startsWith(e)})),rootUrl:"https://"+new URL(t.props.status.target_url).hostname,appender:t.appendToSummary,settings:t.props.settings}))}))))}}]),a}(s.a.Component),G=function(t){Object(c.a)(a,t);var e=Object(m.a)(a);function a(t){var n;return Object(l.a)(this,a),(n=e.call(this,t)).state={summary:{task:{completed:{},failed:{},exception:{},running:{},pending:{},unscheduled:{}},image:{}}},n.appendToSummary=n.appendToSummary.bind(Object(g.a)(n)),n}return Object(u.a)(a,[{key:"appendToSummary",value:function(t){var e=this;this.setState((function(a){var n={task:{completed:Object(o.a)(Object(o.a)({},a.summary.task.completed),t.task.completed),failed:Object(o.a)(Object(o.a)({},a.summary.task.failed),t.task.failed),exception:Object(o.a)(Object(o.a)({},a.summary.task.exception),t.task.exception),running:Object(o.a)(Object(o.a)({},a.summary.task.running),t.task.running),pending:Object(o.a)(Object(o.a)({},a.summary.task.pending),t.task.pending),unscheduled:Object(o.a)(Object(o.a)({},a.summary.task.unscheduled),t.task.unscheduled)},image:Object(o.a)(Object(o.a)({},a.summary.image),t.image)};return e.props.appender(n),{summary:n}}))}},{key:"render",value:function(){var t=this;return s.a.createElement(x.a,{variant:"tabs",transition:!1,defaultActiveKey:"0"},this.props.contexts.reverse().map((function(e,a){return s.a.createElement(w.a,{key:a,eventKey:a,title:s.a.createElement(s.a.Fragment,null,s.a.createElement("img",{style:{width:"30px",height:"30px",marginRight:"1em"},src:t.props.statuses.find((function(t){return t.context===e})).avatar_url,alt:e}),s.a.createElement("span",null,e))},s.a.createElement("hr",{style:{borderStyle:"dotted"}}),t.props.statuses.some((function(t){return t.context===e&&"pending"!==t.state}))?t.props.statuses.filter((function(t){return t.context===e&&"pending"!==t.state})).map((function(e){return s.a.createElement($,{status:e,key:e.id,appender:t.appendToSummary,settings:t.props.settings})})):t.props.statuses.filter((function(t){return t.context===e})).map((function(e){return s.a.createElement($,{status:e,key:e.id,appender:t.appendToSummary,settings:t.props.settings})})))})))}}]),a}(s.a.Component),H=function(t){Object(c.a)(a,t);var e=Object(m.a)(a);function a(t){var n;return Object(l.a)(this,a),(n=e.call(this,t)).state={summary:{task:{completed:{},failed:{},exception:{},running:{},pending:{},unscheduled:{}},image:{}},contexts:[],statuses:[],expanded:!1},n.appendToSummary=n.appendToSummary.bind(Object(g.a)(n)),n}return Object(u.a)(a,[{key:"appendToSummary",value:function(t){this.setState((function(e){return{summary:{task:{completed:Object(o.a)(Object(o.a)({},e.summary.task.completed),t.task.completed),failed:Object(o.a)(Object(o.a)({},e.summary.task.failed),t.task.failed),exception:Object(o.a)(Object(o.a)({},e.summary.task.exception),t.task.exception),running:Object(o.a)(Object(o.a)({},e.summary.task.running),t.task.running),pending:Object(o.a)(Object(o.a)({},e.summary.task.pending),t.task.pending),unscheduled:Object(o.a)(Object(o.a)({},e.summary.task.unscheduled),t.task.unscheduled)},image:Object(o.a)(Object(o.a)({},e.summary.image),t.image)}}}))}},{key:"componentDidMount",value:function(){var t=this;this.setState((function(e){return{expanded:t.props.expand}}));var e=Math.floor(55e3*Math.random())+5e3;this.interval=setInterval(this.getBuildStatuses.bind(this),e)}},{key:"componentWillUnmount",value:function(){clearInterval(this.interval)}},{key:"getBuildStatuses",value:function(){var t=this;fetch("localhost"===window.location.hostname?"http://localhost:8010/proxy/repos/mozilla-platform-ops/cloud-image-builder/commits/"+this.props.commit.sha+"/statuses":"https://grenade-cors-proxy.herokuapp.com/https://api.github.com/repos/mozilla-platform-ops/cloud-image-builder/commits/"+this.props.commit.sha+"/statuses").then((function(t){return t.json()})).then((function(e){e.length&&t.setState((function(t){return{contexts:Object(h.a)(new Set(e.map((function(t){return t.context})))).sort((function(t,e){return t.toLowerCase().localeCompare(e.toLowerCase())})),statuses:e}}))})).catch(console.log)}},{key:"render",value:function(){var t=this;return s.a.createElement(f.a,{style:{width:"100%",marginTop:"10px"}},s.a.createElement(f.a.Header,null,s.a.createElement(k.a.Toggle,{as:y.a,variant:"link",eventKey:this.props.commit.sha,onClick:function(){t.setState((function(t){return{expanded:!t.expanded}}))}},this.state.expanded?s.a.createElement(O.a,null):s.a.createElement(O.b,null)),new Intl.DateTimeFormat("en-GB",{year:"numeric",month:"short",day:"2-digit",hour:"numeric",minute:"numeric",timeZoneName:"short"}).format(new Date(this.props.commit.committer.date)),"\xa0",s.a.createElement("a",{href:this.props.commit.url},this.props.commit.sha.substring(0,7)),Object.keys(this.state.summary.task).some((function(e){return Object.keys(t.state.summary.task[e]).length>0}))?Object.keys(this.state.summary.task).filter((function(e){return Object.keys(t.state.summary.task[e]).length>0})).map((function(e){return s.a.createElement(b.a,{key:e,style:{marginLeft:"0.3em"},variant:N[e]},Object.keys(t.state.summary.task[e]).length)})):s.a.createElement(j.a,{style:{marginLeft:"0.3em"},animation:"border",size:"sm",variant:"info"}),s.a.createElement(v.a,{src:this.props.commit.author.avatar,alt:this.props.commit.author.name,title:this.props.commit.author.name,rounded:!0,style:{width:"30px",height:"30px",marginLeft:"10px"},className:"float-right"}),s.a.createElement("span",{className:"float-right"},this.props.commit.author.username)),Object.keys(this.state.summary.image).length?s.a.createElement(f.a.Body,null,Object.keys(this.state.summary.image).sort().map((function(e){return s.a.createElement(y.a,{key:e,style:{marginLeft:"0.3em"},variant:"outline-info",size:"sm"},e," ",s.a.createElement(b.a,{variant:"info"},t.state.summary.image[e]))}))):"",s.a.createElement(k.a.Collapse,{eventKey:this.props.commit.sha},s.a.createElement(f.a.Body,null,s.a.createElement(E,{message:this.props.commit.message}),s.a.createElement("hr",null),s.a.createElement(G,{contexts:this.state.contexts,statuses:this.state.statuses,appender:this.appendToSummary,settings:this.props.settings}))))}}]),a}(s.a.Component),q=function(t){Object(c.a)(a,t);var e=Object(m.a)(a);function a(){return Object(l.a)(this,a),e.apply(this,arguments)}return Object(u.a)(a,[{key:"render",value:function(){var t=this;return this.props.commits.length?s.a.createElement(k.a,{transition:null,defaultActiveKey:null},this.props.commits.map((function(e){return s.a.createElement(H,{commit:e,key:e.sha,expand:!1,settings:t.props.settings})}))):s.a.createElement("div",{style:{textAlign:"center",width:"100%",padding:"100px"}},s.a.createElement(j.a,{animation:"border"}))}}]),a}(s.a.Component),P=a(33),F=a(64),Z=a(54),J=a(53),V=a(66),Q=a(65),X=function(t){Object(c.a)(a,t);var e=Object(m.a)(a);function a(){var t;Object(l.a)(this,a);for(var n=arguments.length,s=new Array(n),r=0;r<n;r++)s[r]=arguments[r];return(t=e.call.apply(e,[this].concat(s))).cookies=new V.a,t.state={commits:[],settings:{fluid:void 0===t.cookies.get("fluid")||null===t.cookies.get("fluid")||"true"===t.cookies.get("fluid"),limit:void 0===t.cookies.get("limit")||null===t.cookies.get("limit")?{commits:1,tasks:["03","04"]}:t.cookies.get("limit")}},t}return Object(u.a)(a,[{key:"componentDidMount",value:function(){void 0!==this.cookies.get("fluid")&&null!==this.cookies.get("fluid")||this.cookies.set("fluid",!0,{path:"/",sameSite:"strict"}),void 0!==this.cookies.get("limit")&&null!==this.cookies.get("limit")||this.cookies.set("limit",this.state.settings.limit,{path:"/",sameSite:"strict"}),this.getCommits(this.state.settings.limit.commits);this.interval=setInterval(this.getCommits.bind(this),3e5)}},{key:"componentWillUnmount",value:function(){clearInterval(this.interval)}},{key:"getCommits",value:function(t){var e=this;null!==t&&void 0!==t||(t=void 0===this.cookies.get("limit")||null===this.cookies.get("limit")?1:this.cookies.get("limit").commits),fetch("localhost"===window.location.hostname?"http://localhost:8010/proxy/repos/mozilla-platform-ops/cloud-image-builder/commits":"https://grenade-cors-proxy.herokuapp.com/https://api.github.com/repos/mozilla-platform-ops/cloud-image-builder/commits").then((function(t){return t.json()})).then((function(a){a.length&&e.setState((function(e){return{commits:a.slice(0,t).map((function(t){return{sha:t.sha,url:t.html_url,author:Object(o.a)(Object(o.a)({},t.commit.author),{id:t.author.id,username:t.author.login,avatar:t.author.avatar_url}),committer:Object(o.a)(Object(o.a)({},t.commit.committer),{id:t.committer.id,username:t.committer.login,avatar:t.committer.avatar_url}),message:t.commit.message.split("\n").filter((function(t){return""!==t})),verification:t.commit.verification}})),latest:a[0].sha}}))})).catch(console.log)}},{key:"render",value:function(){var t=this;return s.a.createElement(F.a,{fluid:void 0===this.state.settings.fluid||null===this.state.settings.fluid||this.state.settings.fluid},s.a.createElement(J.a,null,s.a.createElement("h1",{style:{padding:"0 1em"}},s.a.createElement(p.a,{style:{marginRight:"0.4em"},icon:d.a}),s.a.createElement(p.a,{style:{marginRight:"0.4em"},icon:d.c}),s.a.createElement(p.a,{style:{marginRight:"0.4em"},icon:d.b}),"recent commits and builds")),s.a.createElement(J.a,null,s.a.createElement(P.a,null,s.a.createElement(q,{commits:this.state.commits,latest:this.state.latest,settings:this.state.settings})),s.a.createElement(P.a,{sm:"2"},s.a.createElement("strong",null,"legend"),s.a.createElement("br",{style:{marginTop:"20px"}}),"task status:",Object.keys(N).map((function(t){return s.a.createElement(b.a,{key:t,style:{display:"block",margin:"10px 20px"},variant:N[t]},t)})),"image deployment:",s.a.createElement("br",null),s.a.createElement(y.a,{style:{marginLeft:"0.3em"},variant:"outline-info",size:"sm"},"worker pool ",s.a.createElement(b.a,{variant:"info"},"region count")),s.a.createElement("hr",null),s.a.createElement("strong",null,"display settings:"),s.a.createElement("br",null),s.a.createElement(Q.a,{defaultValue:this.state.settings.limit.commits,min:1,max:30,onChange:function(e){var a={commits:e,tasks:t.state.settings.limit.tasks};t.cookies.set("limit",a,{path:"/",sameSite:"strict"}),t.setState((function(t){return{settings:{fluid:t.settings.fluid,limit:a}}})),t.getCommits(e)},style:{marginTop:"20px"}}),"limit commits (",this.state.settings.limit.commits,")",s.a.createElement("br",{style:{marginBottom:"20px"}}),s.a.createElement(Z.a.Check,{type:"switch",id:"showAllTasks",label:"all tasks",checked:this.state.settings.limit.tasks.length>2,onChange:function(){var e={commits:t.state.settings.limit.commits,tasks:t.state.settings.limit.tasks.length>2?["03","04"]:["00","01","02","03","04"]};t.cookies.set("limit",e,{path:"/",sameSite:"strict"}),t.setState((function(t){return{settings:{fluid:t.settings.fluid,limit:e}}}))}}),s.a.createElement("br",null),s.a.createElement(Z.a.Check,{type:"switch",id:"fluid",label:"fluid",checked:this.state.settings.fluid,onChange:function(){var e=!t.state.settings.fluid;t.cookies.set("fluid",e,{path:"/",sameSite:"strict"}),t.setState((function(t){return{settings:{fluid:e,limit:t.settings.limit}}}))}}),s.a.createElement("hr",null),s.a.createElement("p",{className:"text-muted"},s.a.createElement("strong",null,"cloud image builder")," automates the creation of windows machine images on cloud platforms. it accomplishes this using tasks running in mozilla's taskcluster ci framework, on workers and resources that run within the target cloud platforms. the objective is carried out by the following task sequence implementation:"),s.a.createElement("ol",{type:"1",start:"0",className:"text-muted"},s.a.createElement("li",null,s.a.createElement("strong",null,"setup tasks"),s.a.createElement("ul",null,s.a.createElement("li",null,"decision task: analyse commit message and generate tasks"),s.a.createElement("li",null,"cleanup tasks: purge deprecated and orphaned resources on the target cloud platforms"),s.a.createElement("li",null,"validation tasks: lint and validate the cib repository commit"))),s.a.createElement("li",null,s.a.createElement("strong",null,"disk image builds"),s.a.createElement("ol",{type:"i"},s.a.createElement("li",null,"download and mount a windows iso"),s.a.createElement("li",null,"create and mount a virtual hard disk (vhd)"),s.a.createElement("li",null,"install windows setup files from the iso to the vhd"),s.a.createElement("li",null,"add target platform specific drivers and installer packages to the vhd in conventional locations to be installed by the windows setup process (sysprep) later"),s.a.createElement("li",null,"add a sysprep unattend.xml instruction set to the vhd"),s.a.createElement("li",null,"dismount and save the prepared vhd"),s.a.createElement("li",null,"upload vhd to the target cloud platform"))),s.a.createElement("li",null,s.a.createElement("strong",null,"machine image builds"),s.a.createElement("ol",{type:"i"},s.a.createElement("li",null,"mount disk image (vhd) as a virtual machine (vm) instance boot disk on the target cloud platform and boot the vm"),s.a.createElement("li",null,"allow time for the vm to boot, and for it to discover and execute the instruction set from its included sysprep configuration and unattend file"),s.a.createElement("li",null,"simulate manual restarts (by issuing cloud api restart requests) as required by the sysprep instruction set"),s.a.createElement("li",null,"trigger the execution of any additional configured execution instructions or bootstrapping scripts"),s.a.createElement("li",null,"await final shutdown of the vm"),s.a.createElement("li",null,"capture vm as a platform specific machine image"),s.a.createElement("li",null,"tag machine image with metadata and mark as generalized or specialized as per image sysprep configuration"))),s.a.createElement("li",null,s.a.createElement("strong",null,"generate taskcluster worker-pool configurations"),s.a.createElement("ol",{type:"i"},s.a.createElement("li",null,"generate markdown describing new machine images"),s.a.createElement("li",null,"generate yaml defining new machine images"),s.a.createElement("li",null,"update taskcluster worker-manager with new pool definitions"))),s.a.createElement("li",null,s.a.createElement("strong",null,"validate new machine images (not implemented)"),s.a.createElement("ol",{type:"i"},s.a.createElement("li",null,"run tasks against new worker pools that verify the pool capacity to claim and complete tasks"),s.a.createElement("li",null,"run tasks against new worker pools that verify the pool competence to produce expected output and artifacts")))),s.a.createElement("p",{className:"text-muted"},"this page is a simple react app which monitors ",s.a.createElement("a",{href:"https://github.com/mozilla-platform-ops/cloud-image-builder/commits/master"},"commits")," to the master branch of the ",s.a.createElement("a",{href:"https://github.com/mozilla-platform-ops/cloud-image-builder"},"mozilla-platform-ops/cloud-image-builder")," repository and the resulting ",s.a.createElement("a",{href:"https://travis-ci.org/github/mozilla-platform-ops/cloud-image-builder/builds"},"travis-ci builds")," and taskcluster tasks (",s.a.createElement("a",{href:"https://stage.taskcluster.nonprod.cloudops.mozgcp.net/tasks/index/project.relops.cloud-image-builder"},"staging"),", ",s.a.createElement("a",{href:"https://firefox-ci-tc.services.mozilla.com/tasks/index/project.relops.cloud-image-builder"},"production"),") which produce cloud machine images of the various windows operating system editions and configurations used by firefox ci to build and test gecko products on the windows platform."),s.a.createElement("p",{className:"text-muted"},"the source code for this page is hosted in the ",s.a.createElement("a",{href:"https://github.com/mozilla-platform-ops/cloud-image-builder/tree/react"},"react branch")," of the same repository."))))}}]),a}(s.a.Component);Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));i.a.render(s.a.createElement(s.a.StrictMode,null,s.a.createElement(X,null)),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(t){t.unregister()})).catch((function(t){console.error(t.message)}))},67:function(t,e,a){t.exports=a(303)},75:function(t,e,a){}},[[67,1,2]]]);
//# sourceMappingURL=main.34c2f0cc.chunk.js.map